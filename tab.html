<script>
(function () {
  const PASSWORD = 'z';        // 想改的密码
  const COOKIE_NAME = 'myToolPass';

  /* ---------- 读 Cookie ---------- */
  function getCookie(name) {
    const m = document.cookie.match(new RegExp('(?:^|;\\s*)' + name + '=([^;]*)'));
    return m ? decodeURIComponent(m[1]) : null;
  }

  /* ---------- 写 4 小时后失效的 Cookie ---------- */
  function setFourHourCookie(name, value) {
    const fourHourLater = new Date();
    fourHourLater.setTime(fourHourLater.getTime() + 4 * 60 * 60 * 1000); // 4 小时
    document.cookie = `${name}=${encodeURIComponent(value)}; expires=${fourHourLater.toUTCString()}; path=/`;
  }

  /* ---------- 阻塞等待 ---------- */
  function sleep(ms) {
    const start = Date.now();
    while (Date.now() - start < ms) { /* 空转 */ }
  }

  /* ---------- 主逻辑 ---------- */
  if (getCookie(COOKIE_NAME) === 'true') return; // 4 小时内已认证，直接放行

  let wrongCount = 0;
  while (true) {
    const pwd = prompt('请输入访问密码：');
    if (pwd === PASSWORD) {
      setFourHourCookie(COOKIE_NAME, 'true');
      return;            // 认证成功
    }

    wrongCount++;
    if (wrongCount <= 3) {
      alert(`密码错误！剩余 ${4 - wrongCount} 次机会。`);
    } else {
      const waitSec = 2 * (wrongCount - 3);
      alert(`密码错误！请等待 ${waitSec} 秒后再试。`);
      sleep(waitSec * 1000);
    }
  }
})();
</script>
